import org.ajoberstar.grgit.Person

plugins {
  id 'com.avast.gradle.docker-compose' version '0.4.5'
  id 'org.ajoberstar.grgit' version '2.0.0'
}

defaultTasks 'composeDown', 'clean', 'prepFixtures', 'build', ':web:grunt_default', 'composeUp'

composeUp.dependsOn ':java:war'

task prepFixtures {
  description 'Prepare development environment with test fixtures'

  doFirst {

    delete {
      delete fileTree(dir: 'mapfiles')
      delete 'datastore/.git'
      delete fileTree(dir: 'datastore')
    }

    copy {
      into 'datastore'
      from 'fixtures/datastore/REV-1'
    }

    def repo = grgit.init(dir: 'datastore')
    repo.add(patterns: ['.'])
    repo.commit(message: 'Adding fixtures', committer: new Person('prep', 'prep@example.com'))
  }
}
