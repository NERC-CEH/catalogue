<VirtualHost *:80>
  DocumentRoot /var/www/html

  <Directory "/usr/lib/cgi-bin">
    AllowOverride None
    Require all granted
    SetHandler fcgid-script
  </Directory>

  ## Logging
  ErrorLog "${APACHE_LOG_DIR}/mapserver-default_error.log"
  ServerSignature Off
  CustomLog "${APACHE_LOG_DIR}/mapserver-default_access.log" combined
  ## Rewrite rules
  RewriteEngine On

  RewriteCond %{QUERY_STRING} (?:^|&)(?:C|S)RS=EPSG:([^&]+)
  RewriteRule .* - [E=EPSG:%1]
  RewriteCond /mapserver/maps/%{REQUEST_FILENAME}_%{ENV:EPSG}.map -f
  RewriteRule ^/(.*)$ /cgi-bin/mapserv?map=/mapserver/maps/$1_%{ENV:EPSG}.map [QSA,L,NC,PT]

  RewriteCond /mapserver/maps/%{REQUEST_FILENAME}_default.map -f
  RewriteRule ^/(.*)$ /cgi-bin/mapserv?map=/mapserver/maps/$1_default.map [QSA,L,NC,PT]

  ## Script alias directives
  ScriptAlias /cgi-bin "/usr/lib/cgi-bin/"
</VirtualHost>